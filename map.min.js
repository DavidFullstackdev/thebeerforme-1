"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),mapboxgl.accessToken="pk.eyJ1IjoiYzEzc2xhbSIsImEiOiJjaWh2MjBjenEwMXdndHNraGgxYnFrMXVyIn0.EnDtV7OFvEYku7--ecPDJg";var map=new mapboxgl.Map({container:"map",style:"mapbox://styles/c13slam/ck4sv4p6b0sdb1cnnn5670vqk",center:[-100.034084142948,41.909671288923],zoom:3,scrollZoom:!0});map.addControl(new mapboxgl.NavigationControl({showCompass:!1})),map.addControl(new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}).on("geolocate",e=>{map.flyTo({center:[e.coords.longitude,e.coords.latitude],zoom:11})}));var timer,feat=[],delay=0;function createMap(e,t){for(i=0;i<e.length;i++)feat.push({type:"Feature",properties:e[i],geometry:{type:"Point",coordinates:[e[i].lon,e[i].lat]}});var o={type:"FeatureCollection",features:feat};map.addSource("breweries",{type:"geojson",data:o,buffer:0,cluster:!0,clusterMaxZoom:10,clusterRadius:45}),map.addLayer({id:"breweries_layer",type:"symbol",source:"breweries",filter:["!",["has","point_count"]],minzoom:3,layout:{"icon-image":"brewery-marker","icon-size":.4,"icon-allow-overlap":!0,"icon-anchor":"bottom"}}),map.addLayer({id:"clusters",type:"symbol",source:"breweries",filter:["has","point_count"],layout:{"icon-image":"brewery_cluster","icon-size":["step",["get","point_count"],.6,100,.8,750,1],"icon-allow-overlap":!0,"icon-anchor":"center"}}),map.addLayer({id:"cluster-count",type:"symbol",source:"breweries",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":15},paint:{"text-color":"black","text-halo-width":0,"text-halo-color":"black"}}),map.addLayer({id:"labels",type:"symbol",source:"breweries",layout:{"text-field":["get","company"],"text-variable-anchor":["top"],"text-radial-offset":.1,"text-justify":"auto","text-size":12},paint:{"text-color":"#f64c72","text-halo-width":.03,"text-halo-color":"black"}});var a=o.features;n(a);var r=new Fuse(o.features,{keys:["properties.company"],threshold:0,location:0,distance:0});$("#search").autocomplete({source:t,autoFocus:!0,minLength:2,delay:500}),$("#search").on("autocompleteselect",function(e,t){search_result=r.search(t.item.value)[0],map.flyTo({center:search_result.geometry.coordinates,zoom:13})}),map.on("moveend",function(){(a=getPointsInView(o.features))&&n(a)});var s=0;function n(e){e=e.sort(compareValues("company")),clearTimeout(timer),timer=setTimeout(()=>{delay=1400;var t=document.getElementById("listings");t.innerHTML="",t.scrollTo(0,0),s=0,l(e)},delay)}function l(e){if(s<e.length){var t=s+20<e.length?s+20:e.length;for(i=s;i<t;i++){var o=e[i],r=o.properties,n=listings.appendChild(document.createElement("div"));n.className="item",n.id="listing-"+i;var c=n.appendChild(document.createElement("a"));if(c.href="#",c.className="title",c.dataPosition=i,c.innerHTML=r.company,""!=r.website&&null!=r.website)var p='</br><a href="https://'+o.properties.website+'" target="_blank">Website</a>';else p="";var m=n.appendChild(document.createElement("div"));m.className="details",m.innerHTML=r.address+", "+r.city+", "+r.state+", "+r.zip_code+p,c.addEventListener("click",function(t){var o=e[this.dataPosition];flyToStore(o),createPopUp(o);var a=document.getElementsByClassName("active");a[0]&&a[0].classList.remove("active"),this.parentNode.classList.add("active")}),s++}}$(listings).scroll(function(){listings.scrollHeight-listings.scrollTop-1<listings.clientHeight&&l(a)})}}function flyToStore(e){map.flyTo({center:e.geometry.coordinates,zoom:13})}function createPopUp(e){var t=document.getElementsByClassName("mapboxgl-popup");t[0]&&t[0].remove(),""!=e.properties.website&&null!=e.properties.website?website='<h4><a href="https://'+e.properties.website+'" target="_blank">Website</a></h4>':website="";new mapboxgl.Popup({closeOnClick:!0}).setLngLat(e.geometry.coordinates).setHTML("<h3>"+e.properties.company+"</h3><h4>"+e.properties.address+", "+e.properties.city+", "+e.properties.state+", "+e.properties.zip_code+"</h4>"+website).addTo(map)}function getPointsInView(e){viewBounds=map.getBounds();let t=[];for(i=0;i<e.length;i++)e[i].geometry.coordinates[0]>viewBounds._sw.lng&&e[i].geometry.coordinates[1]>viewBounds._sw.lat&&e[i].geometry.coordinates[0]<viewBounds._ne.lng&&e[i].geometry.coordinates[1]<viewBounds._ne.lat&&t.push(e[i]);return t}function compareValues(e,t="asc"){return function(o,a){if(!o.properties.hasOwnProperty(e)||!a.properties.hasOwnProperty(e))return 0;const r="string"==typeof o.properties[e]?o.properties[e].toUpperCase():o.properties[e],i="string"==typeof a[e]?a.properties[e].toUpperCase():a.properties[e];let s=0;return r>i?s=1:r<i&&(s=-1),"desc"===t?-1*s:s}}map.on("load",function(e){map.addLayer({id:"attribution-layer",type:"circle",source:{type:"geojson",data:{type:"Feature",properties:{},geometry:null}}}),Papa.parse("https://docs.google.com/spreadsheets/d/e/2PACX-1vRrZnllTiVGWFmzzvEXLxAt5boQZZh3krmLbwkTwYT6rmVB_b6ntjmaiI6E2RmsVgzMUFLYbAv5GTaA/pub?output=csv",{download:!0,header:!0,complete:function(e){var t=e,o=[];for(feature of t.data){var a=feature.company;o.push(a)}createMap(t.data,o)}})}),map.on("mouseenter","breweries_layer",()=>{map.getCanvas().style.cursor="pointer"}),map.on("mouseleave","breweries_layer",()=>{map.getCanvas().style.cursor=""}),map.on("click","breweries_layer",function(e){flyToStore(e.features[0]),createPopUp(e.features[0]);var t=document.getElementsByClassName("active");t[0]&&t[0].classList.remove("active"),document.getElementById("listing-"+i).classList.add("active")});
