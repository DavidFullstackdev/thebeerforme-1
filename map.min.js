"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),mapboxgl.accessToken="pk.eyJ1IjoiYzEzc2xhbSIsImEiOiJjaWh2MjBjenEwMXdndHNraGgxYnFrMXVyIn0.EnDtV7OFvEYku7--ecPDJg";var map=new mapboxgl.Map({container:"map",style:"mapbox://styles/c13slam/ck4nbngoa1bm81clep5ebr8x3",center:[-100.034084142948,41.909671288923],zoom:7,scrollZoom:!0});map.addControl(new mapboxgl.NavigationControl({showCompass:!1})),map.addControl(new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}).on("geolocate",e=>{map.flyTo({center:[e.coords.longitude,e.coords.latitude],zoom:11})}));var timer,feat=[],delay=0;function createMap(e,t){for(i=0;i<e.length;i++)feat.push({type:"Feature",properties:e[i],geometry:{type:"Point",coordinates:[e[i].lon,e[i].lat]}});var o={type:"FeatureCollection",features:feat};map.addLayer({id:"breweries_layer",type:"circle",source:{type:"geojson",data:o},paint:{"circle-radius":4.5,"circle-color":"#8d8741","circle-stroke-width":.3},"icon-allow-overlap":!0}),map.addLayer({id:"breweries_labels",type:"symbol",source:{type:"geojson",data:o},layout:{"text-field":["get","company"],"text-variable-anchor":["bottom","top"],"text-radial-offset":0,"text-justify":"auto","text-size":11},paint:{"text-color":"#8a8888","text-halo-width":.4,"text-halo-color":"#8a0123"}}),map.setLayoutProperty("breweries_labels","visibility","none"),buildLocationList(o.features.sort(compareValues("company")));var a=new Fuse(o.features,{keys:["properties.company"],threshold:0,location:0,distance:0});$("#search").autocomplete({source:t,autoFocus:!0,minLength:2,delay:500}),$("#search").on("autocompleteselect",function(e,t){search_result=a.search(t.item.value)[0],map.flyTo({center:search_result.geometry.coordinates,zoom:13})}),map.on("moveend",function(){map.getZoom()>12?map.setLayoutProperty("breweries_labels","visibility","visible"):map.setLayoutProperty("breweries_labels","visibility","none");var e=getPointsInView(o.features);e&&buildLocationList(e.sort(compareValues("company")))})}function flyToStore(e){map.flyTo({center:e.geometry.coordinates,zoom:13})}function createPopUp(e){var t=document.getElementsByClassName("mapboxgl-popup");t[0]&&t[0].remove(),""!=e.properties.website&&null!=e.properties.website?website='<h4><a href="https://'+e.properties.website+'" target="_blank">Website</a></h4>':website="";new mapboxgl.Popup({closeOnClick:!0}).setLngLat(e.geometry.coordinates).setHTML("<h3>"+e.properties.company+"</h3><h4>"+e.properties.address+", "+e.properties.city+", "+e.properties.state+", "+e.properties.zip_code+"</h4>"+website).addTo(map)}function getPointsInView(e){viewBounds=map.getBounds();let t=[];for(i=0;i<e.length;i++)e[i].geometry.coordinates[0]>viewBounds._sw.lng&&e[i].geometry.coordinates[1]>viewBounds._sw.lat&&e[i].geometry.coordinates[0]<viewBounds._ne.lng&&e[i].geometry.coordinates[1]<viewBounds._ne.lat&&t.push(e[i]);return t}function compareValues(e,t="asc"){return function(o,a){if(!o.properties.hasOwnProperty(e)||!a.properties.hasOwnProperty(e))return 0;const r="string"==typeof o.properties[e]?o.properties[e].toUpperCase():o.properties[e],i="string"==typeof a[e]?a.properties[e].toUpperCase():a.properties[e];let s=0;return r>i?s=1:r<i&&(s=-1),"desc"===t?-1*s:s}}function buildLocationList(e){clearTimeout(timer),timer=setTimeout(()=>{delay=1850;var t=document.getElementById("listings");for(t.innerHTML="",i=0;i<e.length;i++){var o=e[i],a=o.properties,r=t.appendChild(document.createElement("div"));r.className="item",r.id="listing-"+i;var s=r.appendChild(document.createElement("a"));if(s.href="#",s.className="title",s.dataPosition=i,s.innerHTML=a.company,""!=a.website&&null!=a.website)var n='</br><a href="https://'+o.properties.website+'" target="_blank">Website</a>';else n="";r.appendChild(document.createElement("div")).innerHTML=a.address+", "+a.city+", "+a.state+", "+a.zip_code+n,s.addEventListener("click",function(t){var o=e[this.dataPosition];flyToStore(o),createPopUp(o);var a=document.getElementsByClassName("active");a[0]&&a[0].classList.remove("active"),this.parentNode.classList.add("active")})}},delay)}map.on("load",function(e){map.addLayer({id:"attribution-layer",type:"circle",source:{type:"geojson",data:{type:"Feature",properties:{},geometry:null}}}),Papa.parse("https://docs.google.com/spreadsheets/d/e/2PACX-1vRrZnllTiVGWFmzzvEXLxAt5boQZZh3krmLbwkTwYT6rmVB_b6ntjmaiI6E2RmsVgzMUFLYbAv5GTaA/pub?output=csv",{download:!0,header:!0,complete:function(e){var t=e,o=[];for(feature of t.data){var a=feature.company;o.push(a)}createMap(t.data,o)}})}),map.on("mouseenter","breweries_layer",()=>{map.getCanvas().style.cursor="pointer"}),map.on("mouseleave","breweries_layer",()=>{map.getCanvas().style.cursor=""}),map.on("click","breweries_layer",function(e){flyToStore(e.features[0]),createPopUp(e.features[0]);var t=document.getElementsByClassName("active");t[0]&&t[0].classList.remove("active"),document.getElementById("listing-"+i).classList.add("active")});
